<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Programs extends Frontend_Controller {	public $_subView = 'templates/programs/';	public function __construct(){		parent::__construct();        $this->perPage = 20;	}	public function index(){		$this->data['active'] = 'home';		$this->data['search'] ='';		$this->data['title'] = "Programs | ".$this->data['settings']['site_name'];		$this->load->view($this->_subView.'index',$this->data);	}		public function view($id=false){		if(!$id){			die('no data');		}		$check_data = $this->data['list_data'] = $this->comman_model->get_by('programs',array('id'=>$id),false,true);		if(!$check_data){			die('no data');		}		$this->data['title'] = $this->data['settings']['site_name'];		$this->load->view($this->_subView.'view',$this->data);	}			function ajax($page_type=false){				$output = array();		$output['result']= 'error';				$name = strtolower($this->input->get('name'));		$city = strtolower($this->input->get('city'));		$state = strtolower($this->input->get('state'));		$zip = strtolower($this->input->get('zip'));		$alumni = strtolower($this->input->get('alumni'));		$userArr =array();		$where_clause = "";		$url = '';		$url .= 'classes='.$this->input->get('classes').'&';		if($name){			$where_clause .= " (LOWER(name) like '%".strtolower($name)."%' or LOWER(company_name) like '%".strtolower($name)."%' ) and";		}		$url .= 'name='.$name.'&';		if($city){			$where_clause .= " LOWER(city) like '%".strtolower($city)."%' and";		}		$url .= 'city='.$city.'&';		if($state){			$where_clause .= " LOWER(state) like '%".strtolower($state)."%' and";		}		$url .= 'state='.$state.'&';		if($zip){			$where_clause .= " zip like '%".$zip."%' and";		}		$url .= 'zip='.$zip.'&';/*		if($alumni){			$where_clause .= " LOWER(alumni) like '%".strtolower($alumni)."%' and";		}		$url .= 'alumni='.$alumni.'&';*//*		echo $url;		echo '<br>';*/		$where_clause = rtrim($where_clause,'and');		$page = $this->input->get('page');        if(!$page){			$this->data['page_number'] =1;            $offset = 0;        }else{			$offset = $page*20-20;			//$offset = $page*2-2;			$this->data['page_number'] = $page;        }				$this->data['total'] = $output['total'] = 0;		$output['result']= 'ok';		$stringQuery = "SELECT * FROM (`programs`) WHERE enabled =1 ";			//$stringQuery.$where_clause." limit $offset , ".$this->perPage;die;		$this->data['products'] = $this->comman_model->get_query($stringQuery,false);		$this->data['total'] = $output['total'] = print_count_query($stringQuery);		$output['html'] = $this->load->view($this->_subView.'ajax_search',$this->data,true);		if(empty($output['html'])){			$output['html'] ='';		}		$checkMoreD = $this->comman_model->get_query($stringQuery.$where_clause,false);		$output['url']= site_url().'programs?'.$url;		$output['ajax_url']= site_url().'programs/ajax?'.$url;				echo json_encode($output);	}		public function map(){		$this->data['title'] = "Programs | ".$this->data['settings']['site_name'];		$this->load->view($this->_subView.'index_map',$this->data);	}		function ajax_map($page_type=false){				$output = array();		$output['result']= 'error';				$name = strtolower($this->input->get('name'));		$city = strtolower($this->input->get('city'));		$state = strtolower($this->input->get('state'));		$zip = strtolower($this->input->get('zip'));		$alumni = strtolower($this->input->get('alumni'));		$userArr =array();		$where_clause = "";		$url = '';		$url .= 'classes='.$this->input->get('classes').'&';		if($name){			$where_clause .= " (LOWER(name) like '%".$name."%' or LOWER(company_name) like '%".$name."%' ) and";		}		$url .= 'name='.$name.'&';		if($city){			$where_clause .= " LOWER(city) like '%".$city."%' and";		}		$url .= 'city='.$city.'&';		if($state){			$where_clause .= " LOWER(state) like '%".$state."%' and";		}		$url .= 'state='.$state.'&';		if($zip){			$where_clause .= " zip like '%".$zip."%' and";		}		$url .= 'zip='.$zip.'&';/*		if($alumni){			$where_clause .= " LOWER(alumni) like '%".$alumni."%' and";		}		$url .= 'alumni='.$alumni.'&';*//*		echo $url;		echo '<br>';*/		$where_clause = rtrim($where_clause,'and');		$page = $this->input->get('page');        if(!$page){			$this->data['page_number'] =1;            $offset = 0;        }else{			$offset = $page*20-20;			//$offset = $page*2-2;			$this->data['page_number'] = $page;        }				$this->data['total'] = $output['total'] = 0;		$output['result']= 'ok';		$stringQuery = "SELECT * FROM (`programs`) WHERE enabled =1 and  gps!='' ";			//die;		//$this->data['products'] = $this->comman_model->get_query($stringQuery.$where_clause,false);		//echo $stringQuery.$where_clause."";die;		//echo $stringQuery.$where_clause." limit $offset ,$limit";die;		$this->data['products'] = $this->comman_model->get_query($stringQuery,false);		$this->data['total'] = $output['total'] = print_count_query($stringQuery);		$output['html'] = $this->load->view($this->_subView.'ajax_search_map',$this->data,true);		if(empty($output['html'])){			$output['html'] ='';		}		$checkMoreD = $this->comman_model->get_query($stringQuery.$where_clause,false);				$output['url']= site_url().'programs/map?'.$url;		$output['ajax_url']= site_url().'programs/ajax_map?'.$url;				echo json_encode($output);	}	}